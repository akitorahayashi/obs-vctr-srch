---
tags:
  - android
  - java
  - kotlin
  - development/flow
  - build/gradle
  - android/studio
  - android/art
---

# Androidアプリ開発の環境構築からユーザーの手元での実行まで
このドキュメントは、PCのセットアップからGoogle Playストア経由でユーザーにアプリを届けるまでの、[[android-development-flow|Android]]アプリ開発の全フローを概説します。

## 1. 開発環境のセットアップ（PCの準備）
このステップでは、すべての開発の基盤となるPC環境を準備します。

### 1-1. 基本ツールの準備
- **Homebrew**: macOS用のパッケージマネージャー。Javaなどのツールを簡単にインストールするために使用します。
- **Git**: ソースコードの履歴を管理するためのバージョン管理システム。

### 1-2. Java開発環境（JDK）とランタイム（JVM）
- **JDK (Java Development Kit)のインストール**: Homebrewを使い、`temurin`のようなJDKをインストールします。
- **JAVA_HOMEの設定**: PCにJavaの場所を教えるための環境変数を設定します。
- **開発環境のランタイム（JVM）**: JDKをインストールすると、JVM（Java仮想マシン）もセットアップされます。このJVMは、開発PC上で実行されるすべてのツールの「実行エンジン」です。Android Studio、Gradle、各種コンパイラ（Kotlin, Java, D8）はすべてJVM上で動作するJavaアプリケーションです。開発とビルドのプロセス全体が、このJVM基盤の上で実行されます。
- **役割の明確化**: 開発PC上では、JVMがすべてのツールを実行します。完成したアプリがユーザーのスマートフォンに載って初めて、ART（Androidランタイム）がアプリを実行します。AOTやJITコンパイルは、デバイス上のARTが行う最適化であり、ビルドプロセス中にPCのJVMが行うものではありません。

### 1-3. Android Studio（統合開発環境）
- **Android Studioのインストール**: コーディング、デバッグ、ビルドなど、開発に必要なすべての機能を含む公式IDEです。
- **SDK Managerの設定**: 開発者がSDK Manager自体のバージョンを気にする必要はほとんどありません。SDK Managerは単なる**「管理ツール（マネージャー）」**です。重要なのは、それが管理する**コンポーネントのバージョン**です。
  - **SDK Platforms**: 開発対象としたいAndroid OSのバージョン（APIレベル）をインストールします。
  - **SDK Tools**: 開発を補助するツール群を管理します。
    - **Android SDK Build-Tools**: アプリのビルドに不可欠なツールセットです。JavaバイトコードをDEXフォーマットに変換するD8コンパイラや、リソースをパッケージ化するAAPT2が含まれます。使用するBuild-ToolsのバージョンはプロジェクトのGradleファイルで指定され、SDK Managerはその指定に基づいて必要なバージョンをダウンロード・管理します。
    - **Android Emulator**: 開発中にアプリをテストするための仮想デバイスです。
    - **Android SDK Platform-Tools**: `adb`コマンドなど、デバイスとの接続やデバッグを行うためのツールです。
- **エミュレータの作成**: SDK Manager経由でインストールしたツールを使い、テスト用の仮想Androidデバイスを作成します。

## 2. アプリケーションの開発とビルド
このステップでは、コードを記述し、それをアプリケーションに変換します。

### 2-1. コーディング
- **言語**: アプリのロジックとUIを記述するためにKotlinを使用します。Googleが公式に推奨する現代的なプログラミング言語であり、Javaと100%相互運用可能です。
- **API**: SDK Manager経由でインストールしたAndroid API（機能のルールブック）を使い、OSの機能（カメラ、通知など）を呼び出します。

### 2-2. ビルドプロセス（Gradleによる自動化）
ビルドボタンを押すと、以下のプロセスが自動的に実行されます。
1.  **依存関係の取得（初回のみ）**
    - `build.gradle.kts`ファイルで定義されたバージョンに基づき、Gradleはインターネット上の公開リポジトリ（Maven Centralなど）から必要なライブラリをダウンロードし、PCのGradleキャッシュに保存します。
    - **Kotlinコンパイラと標準ライブラリ**: これらはJDKに含まれていないため、このステップでGradleが自動的に取得します。これにより、プロジェクトごとに異なるバージョンのKotlinを使用できます。
2.  **コンパイル（ソースコード → バイトコード）**
    - `.kt`ファイル → Kotlinコンパイラ（K2） → Javaバイトコード（`.class`）
    - Kotlinコンパイラは、KotlinソースコードをJavaソースコードに変換するのではなく、直接Javaバイトコードにコンパイルします。
    - `.java`ファイル → Javaコンパイラ（JDKの一部） → Javaバイトコード（`.class`）
    - ※ これら2つのコンパイラは独立して動作し、それぞれの出力（Javaバイトコード）を同じ場所に集めます。
3.  **DEXファイルへの変換**
    - すべてのJavaバイトコード（`.class`） → D8コンパイラ → DEX（Dalvik Executable）ファイル
    - ※ DEXは、Androidランタイム環境（ART）が理解できるフォーマットです。D8コンパイラは、SDK Managerが管理するAndroid SDK Build-Toolsに含まれるツールです。
4.  **パッケージング（部品を1つのアプリにまとめる）**
    - AAPT2（Android Asset Packaging Tool 2）が、前ステップで作成されたDEXファイル、リソースファイル（画像、レイアウトなど）、`AndroidManifest.xml`を1つのアプリケーションにパッケージングします。この過程で、リソースはAndroidが効率的に読み取れるように最適化されます。AAPT2もAndroid SDK Build-Toolsの一部です。

このプロセスの最終的な出力は、インストール可能なAPKまたは公開可能なAABファイルです。
- **APK (Android Package Kit)**: Androidデバイスに直接インストールして実行できる完全なアプリケーションパッケージ。DEXファイル、リソース、マニフェストファイルなどを含みます。
- **AAB (Android App Bundle)**: Google Playにアップロードするための配布形式。

## 3. テストとデバッグ
このステップでは、作成したアプリが正しく動作するかを検証し、問題を修正します。
- **デバッグ**: Android Studioのデバッガを使い、作成したエミュレータやUSB接続した物理デバイスでアプリを実行します。
- **ADB (Android Debug Bridge)**: ADBを使い、アプリの状態確認、ログの監視、ファイルの転送などを行います。

## 4. リリースとユーザーへの配布
最終ステップは、完成したアプリを世界中のユーザーに届けることです。

### 4-1. Google Playへのアップロード
- 開発者アカウントを作成し、完成したAAB（Android App Bundle）ファイルをGoogle Playコンソールにアップロードします。
- **AABとは？**: アプリのコードとリソース（画像、言語ファイルなど）のすべてを含む「公開用フォーマット」です。これをアップロードすると、Google Playは不要な部分を削ぎ落とすことで、各ユーザーのデバイス（画面サイズ、CPUの種類、言語設定など）に最適化されたAPKを自動的に生成・配信します。これにより、ユーザーにとってのアプリのダウンロードサイズが最小化されます。
- スクリーンショットや説明文など、ストア掲載用の素材を準備します。

### 4-2. ユーザーデバイスでの実行
1.  **インストール**: ユーザーはGoogle Playストアからアプリをインストールします。Google PlayはAABからユーザーのデバイスに最適化されたAPKを自動生成して配信します。
2.  **実行**: ユーザーがアプリアイコンをタップします。
    - **ART (Android Runtime)** がアプリを実行します。
      - **AOT (Ahead-Of-Time)コンパイル**: インストール時に、コードの一部をあらかじめマシン語にコンパイルしておくことで、起動時間を短縮します。
      - **JIT (Just-In-Time)コンパイル**: アプリの実行中に、頻繁に使用される部分をリアルタイムでマシン語に翻訳し、パフォーマンスを最適化します。

これで、環境構築からユーザーのデバイスでの実行までの全プロセスが完了です。
