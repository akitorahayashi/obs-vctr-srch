---
tags:
  - katex
  - math
  - markdown
  - tutorial
  - documentation
---

# KaTeX完全マスターガイド：ゼロから始める美しい数式表現

こんにちは！今日からあなたの家庭教師として、KaTeX（カテック）の世界を案内します。数学の知識がなくても大丈夫です。このガイドを読み終える頃には、まるで魔法のように、美しい数式を自由自在に書けるようになっているはずです。一緒に一歩ずつ進んでいきましょう！

## KaTeXの基本

まずは、KaTeXが一体何者で、なぜこれほど便利なのかを知ることから始めましょう。

### KaTeXとは何か？ なぜマークダウンで数式を書くのに便利なのか

KaTeXは、ウェブページ上で数式を美しく表示するためのJavaScriptライブラリです。ブログ記事や技術ドキュメントでよく使われるマークダウンは、テキストの構造（見出しやリストなど）を記述するのは得意ですが、複雑な数式を表現する機能は持っていません。

ここでKaTeXの出番です。KaTeXは、数学組版の「王様」とも言える**TeX（テック）**というシステムをベースにしており、非常に高品質な数式表示を実現します。マークダウンの文章の中に、決められた記号でKaTeXのコードを書き加えるだけで、まるで専門書のような美しい数式を埋め込むことができるのです。

KaTeXの最大の魅力は、その**表示速度**です。他の類似ライブラリと比較しても非常に高速に動作するため、たくさんの数式が含まれるページでも、読者を待たせることなく快適に表示できます。

### インライン数式とディスプレイ数式の違いと使い分け

KaTeXで数式を書くには、主に2つの方法があります。これは非常に重要な基本ルールなので、しっかり覚えましょう。

1.  **インライン数式 (Inline Math)**
    *   **書き方**: 数式を1つのドル記号 `$` で囲みます。例: `$E=mc^2$`
    *   **役割**: 文章の「中」に数式を埋め込みたいときに使います。
    *   **特徴**: 文の流れを妨げないように、数式は少しコンパクトな形で表示されます。例えば、総和記号 `∑` の上下の添字は、行間が広がりすぎないように右横に表示されます。
2.  **ディスプレイ数式 (Display Math)**
    *   **書き方**: 数式を2つのドル記号 `$$` で囲みます。例: `$$E=mc^2$$`
    *   **役割**: 数式を独立した行として、中央に目立たせて表示したいときに使います。
    *   **特徴**: 数式をはっきりと見せるために、十分なスペースを使って表示されます。総和記号 `∑` の添字は、記号の真上と真下に配置され、分数も大きく表示されます。

#### 具体例で見る違い

| 項目 | インライン数式 (`$...$`) | ディスプレイ数式 (`$$...$$`) |
| :--- | :--- | :--- |
| **総和** | `$ \sum_{i=1}^{n} i $` | `$$ \sum_{i=1}^{n} i $$` |
| **積分** | `$ \int_{a}^{b} x^2 dx $` | `$$ \int_{a}^{b} x^2 dx $$` |
| **極限** | `$ \lim_{x \to \infty} f(x) $` | `$$ \lim_{x \to \infty} f(x) $$` |

この使い分けの背景には、文章全体の読みやすさを保つというタイポグラフィ（文字組版）の思想があります。インライン数式が背の高い文字を無理やり行に押し込むと、行間が不自然に広がってしまい、文章全体が読みにくくなります。そこで、インラインでは控えめに、ディスプレイでは堂々と表示することで、文章の美しさと数式の明瞭さを両立させているのです。

## 基本的な数式の書き方

ここからは、具体的な数式の書き方を学んでいきましょう。コピー＆ペーストしてすぐに試せるサンプルをたくさん用意しました。

### 四則演算、べき乗、下付き文字

最も基本的な計算式から始めます。

*   **四則演算**: `+`, `-`, `/` はキーボードからそのまま入力します。掛け算には `*` も使えますが、数式では中央の点 `\cdot` ($a \cdot b$) やバツ印 `\times` ($a \times b$) を使うのが一般的です。
    *   コード: `$ a + b - c * d / e $` → $a+b-c*d/e$
    *   コード: `$ a \cdot b \times c \div d $` → $a \cdot b \times c \div d$
*   **べき乗（上付き文字）**: `^` (ハット記号) を使います。
    *   コード: `$ x^2 $` → $x^2$
    *   **重要ルール**: `^` は直後の**1文字**にしか効果がありません。複数の文字を上付きにしたい場合は、波括弧 `{}` でグループ化する必要があります。
        *   間違い: `$ x^10 $` → $x^10$ (1だけが上付きになる)
        *   正しい: `$ x^{10} $` → $x^{10}$
*   **下付き文字**: `_` (アンダースコア) を使います。べき乗と同じく、波括弧のルールが適用されます。
    *   コード: `$ H_2O $` → $H_2O$
    *   **重要ルール**: 複数の文字を下付きにするには `{}` で囲みます。
        *   間違い: `$ a_ij $` → $a_ij$ (iだけが下付きになる)
        *   正しい: `$ a_{ij} $` → $a_{ij}$

### 分数と平方根

*   **分数**: `\frac{分子}{分母}` というコマンドを使います。分子と分母は、それぞれ必ず波括弧 `{}` で囲みます。
    *   コード: `$ \frac{1}{2} $` → $\frac{1}{2}$
    *   複雑な例: `$$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$$` → $$x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$$
*   **平方根**: `\sqrt{中身}` というコマンドを使います。ルートの中身も必ず波括弧 `{}` で囲みます。
    *   コード: `$ \sqrt{2} $` → $\sqrt{2}$
    *   **n乗根**: `\sqrt` の後ろに角括弧 `[]` を使うと、n乗根を表現できます。
        *   コード: `$ \sqrt[3]{8} $` → $\sqrt[3]{8}$

### よく使われるギリシャ文字の一覧

数式ではギリシャ文字が頻繁に登場します。コマンドは簡単で、アルファなら `\alpha`、ベータなら `\beta` のように、英語名の前にバックスラッシュ `\` を付けるだけです。

| 小文字 | コマンド | 大文字 | コマンド |
| :--- | :--- | :--- | :--- |
| α | `\alpha` | Γ | `\Gamma` |
| β | `\beta` | Δ | `\Delta` |
| γ | `\gamma` | Θ | `\Theta` |
| δ | `\delta` | Λ | `\Lambda` |
| ϵ | `\epsilon` | Ξ | `\Xi` |
| ζ | `\zeta` | Π | `\Pi` |
| η | `\eta` | Σ | `\Sigma` |
| θ | `\theta` | Φ | `\Phi` |
| κ | `\kappa` | Ψ | `\Psi` |
| λ | `\lambda` | Ω | `\Omega` |
| μ | `\mu` | | |
| ν | `\nu` | | |
| ξ | `\xi` | | |
| π | `\pi` | | |
| ρ | `\rho` | | |
| σ | `\sigma` | | |
| τ | `\tau` | | |
| ϕ | `\phi` | | |
| χ | `\chi` | | |
| ψ | `\psi` | | |
| ω | `\omega` | | |

### 比較演算子、集合、矢印などの基本的な記号

数式を構成するその他の重要な記号をまとめました。

| カテゴリ | 記号とコマンドの例 |
| :--- | :--- |
| **比較演算子** | `\le` (≤), `\ge` (≥), `\neq` (≠), `\approx` (≈) |
| **集合** | `\in` (∈), `\notin` (∉), `\subset` (⊂), `\cup` (∪), `\cap` (∩), `\emptyset` (∅) |
| **矢印** | `\to` (→), `\rightarrow` (→), `\Rightarrow` (⇒), `\leftrightarrow` (↔), `\iff` (⟺) |
| **その他** | `\infty` (∞), `\nabla` (∇), `\partial` (∂), `\forall` (∀), `\exists` (∃) |

## 応用的な数式の表現

基本をマスターしたら、次はより複雑で構造的な数式に挑戦しましょう。ここでは「環境」という新しい概念が登場します。

### 総和、積分、極限

これらの大きな演算子は、インラインとディスプレイで見た目が変わることを思い出してください。

*   **総和 (∑)**: `\sum_{下限}^{上限}` の形式で書きます。
    *   コード: `$$\sum_{k=1}^{n} k = \frac{n(n+1)}{2}$$`
    *   表示: $$\sum_{k=1}^{n} k = \frac{n(n+1)}{2}$$
*   **積分 (∫)**: `\int_{下端}^{上端}` の形式で書きます。`dx` の前には、少しスペースを空ける `\,` を入れると見た目が綺麗になります。
    *   コード: `$$\int_{0}^{\infty} e^{-x} \, dx = 1$$`
    *   表示: $$\int_{0}^{\infty} e^{-x} \, dx = 1$$
*   **極限 (lim)**: `\lim_{変数 \to 値}` の形式で書きます。
    *   コード: `$$\lim_{x \to 0} \frac{\sin x}{x} = 1$$`
    *   表示: $$\lim_{x \to 0} \frac{\sin x}{x} = 1$$

### 行列

行列のような表形式の数式は `\begin{...}` と `\end{...}` で囲まれた「環境」を使って作成します。環境の中では、`&` で列を区切り、`\\` で行を改行します。

行列を囲む括弧の種類によって、いくつかの環境が用意されています。

| 環境名 | 括弧の種類 | コード例 | 表示例 |
| :--- | :--- | :--- | :--- |
| matrix | なし | `\begin{matrix} a & b \\ c & d \end{matrix}` | $\begin{matrix} a & b \\ c & d \end{matrix}$ |
| pmatrix | 丸括弧 () | `\begin{pmatrix} a & b \\ c & d \end{pmatrix}` | $\begin{pmatrix} a & b \\ c & d \end{pmatrix}$ |
| bmatrix | 角括弧 [] | `\begin{bmatrix} a & b \\ c & d \end{bmatrix}` | $\begin{bmatrix} a & b \\ c & d \end{bmatrix}$ |
| vmatrix | 縦線 || (行列式) | `\begin{vmatrix} a & b \\ c & d \end{vmatrix}` | $\begin{vmatrix} a & b \\ c & d \end{vmatrix}$ |
| Vmatrix | 二重縦線 |||| (ノルム) | `\begin{Vmatrix} a & b \\ c & d \end{Vmatrix}` | $\begin{Vmatrix} a & b \\ c & d \end{Vmatrix}$ |

### 場合分け

条件によって式が変わる「場合分け」も、`cases` 環境を使って簡単に表現できます。

*   コード:
    ```katex
    $$
    f(x) =
    \begin{cases}
      1 & \text{if } x > 0 \\
      0 & \text{if } x = 0 \\
      -1 & \text{if } x < 0
    \end{cases}
    $$
    ```
*   表示:
    $$
    f(x) =
    \begin{cases}
      1 & \text{if } x > 0 \\
      0 & \text{if } x = 0 \\
      -1 & \text{if } x < 0
    \end{cases}
    $$

ここでも `&` を使って、条件部分のテキストを揃えています。また、数式内で通常のテキスト（イタリック体にならない）を表示したい場合は `\text{...}` コマンドを使います。

### 複数の数式を揃える方法

複数行にわたる式の変形を、等号 `=` で揃えて表示したい場合がよくあります。これには `aligned` 環境を使います。

**注意**: LaTeX経験者は `align` 環境を使いたくなるかもしれませんが、KaTeXではサポートされていません。代わりに `aligned` 環境を `$$...$$` の中で使ってください。

*   **書き方**: `aligned` 環境の中で、揃えたい場所（通常は `=` の前）に `&` を置き、`\\` で改行します。
*   コード:
    ```katex
    $$
    \begin{aligned}
    (a+b)^2 &= (a+b)(a+b) \\
             &= a^2 + 2ab + b^2
    \end{aligned}
    $$
    ```
*   表示:
    $$
    \begin{aligned}
    (a+b)^2 &= (a+b)(a+b) \\
             &= a^2 + 2ab + b^2
    \end{aligned}
    $$

## 初心者がつまずきやすいポイントと対策

KaTeXの学習で多くの人がつまずくポイントをまとめました。ここを乗り越えれば、エラーに悩まされる時間がぐっと減ります。

### コマンドを機能させるための波括弧 {} の重要性

これは最もよくある間違いです。`\sqrt` や `\frac`、あるいは上付き `^` や下付き `_` などのコマンドは、その効果が及ぶ範囲を明確にするために波括弧 `{}` を必要とします。

*   **原則**: コマンドの対象が**2文字以上**の場合は、必ず `{}` で囲む。
*   **例（べき乗）**:
    *   間違い: `$ e^2x $` → $e^2x$ （`2` のみがべき乗になる）
    *   正しい: `$ e^{2x} $` → $e^{2x}$
*   **例（分数）**:
    *   間違い: `$ \frac 123 $` → $\frac 123$ （`1` が分子、`2` が分母、`3` は通常文字になる）
    *   正しい: `$ \frac{123}{45} $` → $\frac{123}{45}$

### 特殊文字をそのまま表示させるためのエスケープ方法

`$`, `_`, `{`, `}` などの文字は、KaTeXにとって特別な意味を持つ「予約語」です。これらの文字そのものを表示したい場合は、直前に `\` (バックスラッシュ) を置いて「これはただの文字ですよ」と教えてあげる必要があります。これを**エスケープ**と呼びます。

| 表示したい文字 | 書き方 |
| :--- | :--- |
| `$` | `\$` |
| `_` | `\_` |
| `{` | `\{` |
| `}` | `\}` |
| `&` | `\&` |
| `%` | `\%` |
| `#` | `\#` |
| `\` | `\\textbackslash` |

### よくある記述エラーとその解決策の具体例

| エラーメッセージ（または意図しない表示） | 原因 | 解決策 |
| :--- | :--- | :--- |
| **Undefined control sequence** | コマンドのスペルミス、またはKaTeXでサポートされていないコマンドの使用。 | コマンドが正しいか確認する。例: `\fraq` → `\frac`。サポートされているコマンドは[公式ドキュメント](https://katex.org/docs/supported.html)で確認する。 |
| **Missing { inserted** | コマンドの引数を囲む `{}` が不足している。 | `\sqrt 25` を `\sqrt{25}` のように、引数を `{}` で正しく囲む。 |
| **数式の一部がイタリック体になる** | マークダウンの処理が先に走り、`_` が強調と解釈されてしまった。 | `$` の前後に半角スペースを入れる `$a_b$` や、マークダウンで特別な意味を持つ文字をエスケープする `\_` などの対策を試す。 |
| **行列の括弧が表示されない** | `\begin{pmatrix}` と `\end{matrix}` のように、開始と終了の環境名が一致していない。 | `\begin{pmatrix}` と `\end{pmatrix}` のように、環境名を正確に一致させる。 |
| **`align`環境が使えない** | KaTeXは `align` 環境をサポートしておらず、代わりに `aligned` 環境を使う必要がある。 | `$$\begin{aligned}... \end{aligned}$$` のように書き換える。 |

## 【発展】LLMのための誤表記検出ガイド

ここまでの知識を応用して、AI（LLM）がKaTeXの数式エラーを自動で検出・修正するための基礎となるガイドを作成します。

### LLMのためのKaTeX構文チェックリスト

LLMにKaTeXの文字列を検証させる際、以下の項目を順にチェックさせることで、多くの一般的なエラーを検出できます。このアプローチは、学術研究で提案されているLaTeXコード生成におけるエラー分析手法（構文エラー、パッケージエラー、フォーマットエラーなど）に基づいています。

1.  **デリミタの整合性チェック**
    *   [ ] 開始デリミタ (`$` または `$$`) と終了デリミタは正しくペアになっているか？
    *   [ ] `$` で始まり `$$` で終わる、あるいはその逆のような不一致はないか？
2.  **環境の整合性チェック**
    *   [ ] `\begin{...}` は、同じ名前の `\end{...}` とペアになっているか？ (`\begin{pmatrix}` と `\end{matrix}` はエラー)
3.  **コマンドと引数の整合性チェック**
    *   [ ] `\frac`, `\sqrt`, `\color` のような引数を必要とするコマンドの直後に、必要な数の `{...}` が存在するか？
    *   [ ] すべての `{` に対して、対応する `}` が存在するか？ (ネスト構造も含む)
4.  **コマンドの有効性チェック**
    *   [ ] `\` で始まるすべてのコマンド名は、KaTeXのサポート関数リストに存在するか？ (辞書との照合)
    *   [ ] 一般的なタイポ（例: `\flac`, `\sqlt`, `\alfa`）を検出し、正しいコマンド（`\frac`, `\sqrt`, `\alpha`）を提案できるか？
5.  **特殊文字のエスケープチェック**
    *   [ ] 数式内で特別な意味を持たない `_`, `{`, `}` などが表示されている場合、`\_`, `\{`, `\}` のようにエスケープされているか？

### LLM学習用の「正しい記述」と「間違いやすい記述」のペア

LLMがエラーパターンを学習しやすいように、具体的な「間違い例」と「修正例」をセットで提示します。

| エラーカテゴリ | 間違いやすい記述 (Incorrect) | 正しい記述 (Correct) | 解説 |
| :--- | :--- | :--- | :--- |
| **デリミタの不一致** | `$$E=mc^2 $` | `$$ E=mc^2 $$` | 開始デリミタ `$$` と終了デリミタ `$` が一致していません。 |
| **波括弧の不足 (引数)** | `\sqrt 1 + x` | `\sqrt{1+x}` | `\sqrt` コマンドの効果は直後の1文字 `1` にしか及びません。`1+x` 全体を引数にするには `{}` が必要です。 |
| **波括弧の不足 (上付き)** | `e^2k` | `e^{2k}` | 上付き `^` の効果は直後の `2` にしか及びません。`2k` を指数にするには `{}` が必要です。 |
| **引数の数** | `\frac 12` | `\frac{1}{2}` | `\frac` コマンドは `{分子}` と `{分母}` の2つの引数を必要とします。 |
| **環境名の不一致** | `\begin{pmatrix} a \\ b \end{matrix}` | `\begin{pmatrix} a \\ b \end{pmatrix}` | `\begin` と `\end` の環境名は完全に一致させる必要があります。 |
| **コマンドのタイポ** | `\alfa \cdot \beta` | `\alpha \cdot \beta` | `\alfa` は存在しないコマンドです。正しくは `\alpha` です。 |
| **環境の誤用** | `\begin{align} a&=b \\ c&=d \end{align}` | `$$\begin{aligned} a&=b \\ c&=d \end{aligned}$$` | KaTeXでは `align` の代わりに `aligned` 環境を `$$` の中で使用します。 |
| **エスケープ漏れ** | `{ x | x \in A }` | `\{ x | x \in A \}` | `{` と `}` は特別な意味を持つため、文字として表示するにはエスケープが必要です。 |

このガイドが、あなたのKaTeX学習の助けとなり、さらには未来のAI開発の一助となることを願っています。
