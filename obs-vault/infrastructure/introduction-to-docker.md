---
tags:
  - infrastructure
  - docker
  - container
  - beginner
---
# Docker入門：コンテナ技術への第一歩

## 序章：なぜDockerは現代の開発に不可欠なのか？

現代のソフトウェア開発において、「自分のPCでは動いたのに、サーバー上では動かない」という問題は、多くの開発者が一度は経験する典型的な課題です。この「環境差異」の問題を解決し、開発から本番まで一貫した環境を提供するための強力なツールが、本章で学ぶ**Docker**です。

Dockerは、アプリケーションを「コンテナ」と呼ばれる隔離された軽量な仮想環境にパッケージ化する技術です。これを運送業界における「コンテナ」に例えてみましょう。世界中の港では、中身が電化製品であろうと、食品であろうと、同じ規格のコンテナに詰められていれば、同じクレーンや船で扱うことができます。Dockerもこれと同じで、アプリケーションとその依存関係（ライブラリ、設定ファイルなど）をすべてコンテナに詰め込むことで、どんな環境（開発者のノートPC、テストサーバー、クラウド環境）でも同じように動かすことができるのです。

このコンテナ化のアプローチは、開発の効率化、デプロイの高速化、そしてインフラ管理の簡素化に劇的な効果をもたらします。本章を読み終える頃には、Dockerの基本的な概念を理解し、簡単なWebアプリケーションを自分でコンテナ化して実行できるようになることを目指します。

## 第1部：Dockerのコアコンセプトを理解する

Dockerを効果的に使いこなすためには、まず4つの重要な概念を理解する必要があります。

| コンセプト | 説明 | アナロジー（料理） |
| :--- | :--- | :--- |
| **Dockerfile** | コンテナの設計図。どのようなOSをベースに、どのライブラリを入れ、どのプログラムを実行するかを記述したテキストファイル。 | **レシピ** |
| **Image** | Dockerfileを基に作成された、アプリケーションと実行環境をまとめたパッケージ。読み取り専用。 | **真空パックされた料理キット** |
| **Container** | Imageから作成された、実際に動作しているアプリケーションのインスタンス。Imageを基に、書き込み可能な層が追加された状態。 | **キットを使って実際に調理された料理** |
| **Docker Hub** | Docker Imageを共有・管理するための公式レジストリ（倉庫）。世界中の開発者が作成した便利なImageが公開されている。 | **レシピ共有サイト** |

これらの関係は以下のようになります。
1.  開発者は**Dockerfile**（レシピ）を書きます。
2.  `docker build`コマンドで、Dockerfileから**Image**（料理キット）を作成します。
3.  `docker run`コマンドで、Imageから**Container**（料理）を起動し、アプリケーションを実行します。
4.  必要であれば、作成したImageを**Docker Hub**（レシピ共有サイト）にアップロードして、他の人と共有したり、別の環境で再利用したりします。

## 第2部：必須Dockerコマンドをマスターする

ここでは、日常的な開発で最もよく使う基本的なDockerコマンドを5つ紹介します。

### 1. `docker pull`：イメージのダウンロード
Docker Hubから既存のイメージを手元の環境にダウンロードします。
```bash
# 例：軽量なWebサーバーであるNginxの公式イメージをダウンロード
docker pull nginx:latest
```

### 2. `docker images`：イメージの一覧表示
ローカルに保存されているイメージの一覧を確認します。
```bash
docker images

# 出力例
# REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
# nginx        latest    605c77e624dd   3 weeks ago   141MB
```

### 3. `docker build`：イメージのビルド
Dockerfileを基に、新しいイメージをビルドします。
```bash
# カレントディレクトリのDockerfileを基に、'my-webapp'という名前のイメージをビルド
docker build -t my-webapp .
```
- `-t`: イメージに名前とタグを付けます (`name:tag`)。
- `.` : Dockerfileがある場所（この場合はカレントディレクトリ）を指定します。

> **ポート番号について補足**
>
> - ポート番号は「0」から「65535」までの数字で、最大5桁まで使えます。例えば「80」や「8080」、「12345」など、1〜5桁の数字が使われます。
> - Dockerでポートを指定する場合は「ホスト側:コンテナ側」の形式（例：8080:80）で書きます。どちらも最大5桁まで自由に組み合わせて使えます。
> - 「アプリがリッスンしている」とは、アプリケーションが特定のポート番号で外部からの通信（リクエスト）を待ち受けている状態を指します。例えばWebサーバーは「80番ポート」でブラウザからのアクセスを受け付けます。
> - Dockerでは、コンテナ内のアプリが使うポート（例：80番）と、外部（ホスト）からアクセスするポート（例：8080番）を紐付けて公開します。

### 4. `docker run`：コンテナの起動
イメージから新しいコンテナを起動します。
```bash
# 'my-webapp'イメージからコンテナを起動
# -d: バックグラウンドで実行
# -p 8080:80: ホストの8080番ポートをコンテナの80番ポートに接続
docker run -d -p 8080:80 my-webapp
```

### 5. `docker ps`：コンテナの一覧表示
現在実行中のコンテナの一覧を表示します。
```bash
docker ps

# 出力例
# CONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                  NAMES
# a1b2c3d4e5f6   my-webapp   "/docker-entrypoint.…"   10 seconds ago   Up 9 seconds    0.0.0.0:8080->80/tcp   quirky_einstein
```
- `docker ps -a`とすると、停止中のコンテナも含むすべてのコンテナを表示できます。

## 第3部：実践！DockerfileでWebサーバーを構築する

それでは、実際に簡単なWebサーバーをコンテナ化してみましょう。

### ステップ1：シンプルなWebページの作成
まず、`index.html`という名前で、コンテナ内で表示するための簡単なHTMLファイルを作成します。
```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Docker Test</title>
</head>
<body>
    <h1>Hello, Docker!</h1>
    <p>このページはDockerコンテナ内のNginxサーバーから配信されています。</p>
</body>
</html>
```

### ステップ2：Dockerfileの作成
次に、この`index.html`を配信するためのNginxサーバーの構成を`Dockerfile`に記述します。
```dockerfile
# Dockerfile

# ベースとなるイメージを指定
# 公式のNginxイメージを利用する
FROM nginx:latest

# 作成したHTMLファイルを、コンテナ内のNginxがコンテンツを置くディレクトリにコピー
# COPY [ホストのパス] [コンテナのパス]
COPY index.html /usr/share/nginx/html/index.html
```
このDockerfileは非常にシンプルです。
1.  `FROM nginx:latest`: Docker Hubにある公式のNginxイメージを土台として使います。
2.  `COPY index.html ...`: ホストマシン（あなたのPC）にある`index.html`を、コンテナ内の`/usr/share/nginx/html/`ディレクトリにコピーします。これはNginxがデフォルトでWebページのファイルを探しに行く場所です。

### ステップ3：ビルドと実行
`index.html`と`Dockerfile`が同じディレクトリにあることを確認し、以下のコマンドを実行します。

1.  **イメージをビルドする**
    ```bash
    docker build -t my-first-nginx .
    ```
    これで、`my-first-nginx`という名前の新しいイメージが作成されました。`docker images`で確認してみましょう。

2.  **コンテナを実行する**
    ```bash
    docker run -d -p 8080:80 my-first-nginx
    ```
    これで、バックグラウンドでコンテナが起動しました。

### ステップ4：ブラウザで確認
Webブラウザを開き、アドレスバーに `http://localhost:8080` と入力してください。作成した`index.html`の内容が表示されれば成功です！

## 結論：コンテナ化への扉を開く

本章では、Dockerの基本的な概念とコマンドを学び、実際に簡単なWebサーバーをコンテナ化するプロセスを体験しました。重要なのは、「環境をコード（Dockerfile）で定義し、それを再利用可能なイメージとして固め、どこでも同じように動くコンテナとして実行する」という考え方です。

この基礎をマスターすれば、あなたの開発ワークフローは劇的に改善されるでしょう。

### 次のステップ
- **複数のコンテナを連携させる**: ほとんどのアプリケーションは、Webサーバー、データベース、APIサーバーなど、複数のコンポーネントから構成されます。これらの複数コンテナをまとめて管理するためのツールが**Docker Compose**です。
- **より複雑なアプリケーションへ**: 準備が整ったら、[[declarative-rag-system-docker-compose]] のような、より実践的で複雑なシステムの構築に挑戦してみましょう。Docker Composeを使い、AIアプリケーションを支えるインフラを宣言的に構築する方法を学べます。

Dockerの世界は広大ですが、本章で得た知識は、その世界を探求するための確かな第一歩となるはずです。
